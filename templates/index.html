<!doctype html>
<html>
  <head>
    <title>Disk Info</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css" />
  </head>
  <body>
    <h1>Disk Information</h1>
    <div class="view-switch">
      <a href="/?view=table" class="button">Table View</a>
      <a href="/?view=pichart" class="button">Pichart View</a>
      <a href="/?view=columns" class="button">Columns View</a>
    </div>
    {{if eq .View "table"}}
    <table class="table">
      <tr>
        <th>Device</th>
        <th>Total Size</th>
        <th>Used</th>
        <th>Free</th>
        <th>Type</th>
      </tr>
      {{range .DiskInfos}}
      <tr>
        <td>{{.Device}}</td>
        <td>{{.HumanSize}}</td>
        <td>{{.HumanUsed}}</td>
        <td>{{.HumanFree}}</td>
        <td>{{.Type}}</td>
      </tr>
      {{end}}
    </table>
    {{else}}
    <div class="wrapper">
      {{range .DiskInfos}} {{if eq $.View "pichart"}}
      <div class="disk">
        <div class="info">
          <div class="name">{{.Device}}</div>
          <div class="size">{{.HumanSize}}</div>
        </div>
        <svg class="pie-chart" width="100" height="100" viewBox="0 0 100 100">
          {{if gt .FreePercent 0.0}}
          <circle
            cx="50"
            cy="50"
            r="50"
            fill="#99ff99"
            class="tooltip-trigger"
            data-tooltip="Free: {{.HumanFree}} ({{.FreePercentStr}}%)"
          ></circle>
          {{end}} {{if gt .UsedPercent 0.0}}
          <path
            d="{{.PieChart}}"
            fill="#ff9999"
            class="tooltip-trigger"
            data-tooltip="Used: {{.HumanUsed}} ({{.UsedPercentStr}}%)"
          ></path>
          {{end}} {{if eq .UsedPercent 100.0}}
          <circle
            cx="50"
            cy="50"
            r="50"
            fill="#ff9999"
            class="tooltip-trigger"
            data-tooltip="Used: {{.HumanUsed}} ({{.UsedPercentStr}}%)"
          ></circle>
          {{end}} {{if eq .FreePercent 100.0}}
          <circle
            cx="50"
            cy="50"
            r="50"
            fill="#99ff99"
            class="tooltip-trigger"
            data-tooltip="Free: {{.HumanFree}} ({{.FreePercentStr}}%)"
          ></circle>
          {{end}} {{if gt .UsedPercent 0.0}}
          <text
            x="{{.UsedTextX}}"
            y="{{.UsedTextY}}"
            text-anchor="middle"
            fill="#fff"
            font-size="10"
            font-weight="bold"
            dy=".3em"
          >
            {{.UsedPercentStr}}%
          </text>
          {{end}} {{if gt .FreePercent 0.0}}
          <text
            x="{{.FreeTextX}}"
            y="{{.FreeTextY}}"
            text-anchor="middle"
            fill="#fff"
            font-size="10"
            font-weight="bold"
            dy=".3em"
          >
            {{.FreePercentStr}}%
          </text>
          {{end}}
        </svg>
      </div>
      {{else if eq $.View "columns"}}
      <div class="column">
        <div class="info">
          <div class="name">{{.Device}}</div>
          <div class="size">{{.HumanSize}}</div>
        </div>
        <div class="column-chart">
          <div
            class="used tooltip-trigger"
            style="height: {{.UsedPercent}}%;"
            data-tooltip="Used: {{.HumanUsed}} ({{.UsedPercentStr}}%)"
          >
            {{if gt .UsedPercent 0.0}} {{.UsedPercentStr}}% {{end}}
          </div>
          <div
            class="free tooltip-trigger"
            style="height: {{.FreePercent}}%;"
            data-tooltip="Free: {{.HumanFree}} ({{.FreePercentStr}}%)"
          >
            {{if gt .FreePercent 0.0}} {{.FreePercentStr}}% {{end}}
          </div>
        </div>
      </div>
      {{end}} {{end}}
    </div>
    {{end}}
    <br />
    <div class="tooltip" id="tooltip"></div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const triggers = document.querySelectorAll(".tooltip-trigger");
        const tooltip = document.getElementById("tooltip");

        triggers.forEach((trigger) => {
          trigger.addEventListener("mouseenter", function () {
            tooltip.textContent = this.dataset.tooltip;
            tooltip.style.display = "block";
          });

          trigger.addEventListener("mouseleave", function () {
            tooltip.style.display = "none";
          });

          trigger.addEventListener("mousemove", function (e) {
            tooltip.style.left = e.pageX + 10 + "px";
            tooltip.style.top = e.pageY + 10 + "px";
          });
        });
      });
    </script>
  </body>
</html>
